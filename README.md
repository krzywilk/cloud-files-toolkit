# Cloud files toolkit
The assumption of the repository is to create a set of classes responsible for loading and uploading files from buckets. All classes implementations are kept in a similar manner.


## Installation
Requirements are being created, due to the different types of files that are included in the implementation, there are many references to different libraries in the code. It is necessary to organize the code and requirements in a modular way.

## Basic usage examples
<details>
<summary><b>GCP</b></summary>
<details>
<summary>Loaders</summary>
All loaders implementations are iterable and work with context manager. After opening the object, the indicated file is downloaded to the tmp folder. The file is saved with the name generated by the UUID, so there is no risk of overwriting already existing temporary file. Closing an object deletes the temporary file.

<details>
<summary>Video loaders</summary>

```
import os
import cv2
from loaders.cloud_loaders.iterable_file_loaders.google.video_loaders import EagerVideoGoogleLoader, \
    LazyVideoGoogleLoader

if __name__ == "__main__":
    with EagerVideoGoogleLoader(bucket_name="bucket-name-here",
                                bucket_file_key="path/to/the/file",
                                tmp_folder_path="/path/to/tmp/folder/") as test_loader:
        for frame in test_loader: # list-like object
            cv2.imshow("test", frame)
            cv2.waitKey()
            pass

    with LazyVideoGoogleLoader(bucket_name="bucket-name-here",
                               bucket_file_key="path/to/the/file",
                               tmp_folder_path="/path/to/tmp/folder/") as test_loader:
        for frame in test_loader: # generator-like object
            cv2.imshow("test", frame)
            cv2.waitKey()
            pass

```
</details>
<details>
<summary>Audio loaders</summary>
Due to the characteristics of audio files, it is not necessary to create temporary files, therefore it is not necessary to define the path to the tmp directory.

```
import os
from loaders.cloud_loaders.iterable_file_loaders.google.audio_loaders import AudioGoogleLoader

if __name__ == "__main__":
    with AudioGoogleLoader(bucket_name="bucket-name-here",
                           bucket_file_key="path/to/the/file") as test_loader:
        for elem in test_loader:  # list-like object
            print(elem)
    print("")
```

</details>



</details>
<details>
<summary>Serializers</summary>
All serializers implementations are compatible with context manager. After opening the object, temporary data artifacts are saved in the tmp folder. The file is saved with the name generated by the UUID, so there is no risk of overwriting already existing temporary file. Closing an object deletes the temporary file.

Serializers are also kept in a one-to-many manner. This means that once opened, an object can serialize the file to multiple buckets.

<details>
<summary>Video serializers</summary>


```
from loaders.local_loaders.iterable_file_loaders.audio_loaders import AudioReader
from loaders.local_loaders.iterable_file_loaders.video_loaders import EagerVideoReader

from serializers.cloud_serializers.google.video_serializers import VideoMP4GoogleSerializer, \
    VideoMP4AudioWavGoogleSerializer

if __name__ == "__main__":
    with EagerVideoReader("/path/to/local/file.mp4") as local_video_reader:
        with VideoMP4GoogleSerializer(video_frames_content=local_video_reader.get_file_buffer(),
                                      tmp_folder_directory="/tmp/", fps=25) as mute_video_serializer:
            mute_video_serializer.serialize("bucket-name-here", "path/to/the/file")

        with AudioReader("/path/to/local/file.wav") as wav:
            with VideoMP4AudioWavGoogleSerializer(video_content=local_video_reader.get_file_buffer(),
                                                  tmp_folder_directory="/tmp/", fps=25, sampling_rate=wav.sampling_rate,
                                                  wav_audio_content=wav.get_file_buffer()) as audio_video_serializer:
                audio_video_serializer.serialize("bucket-name-here", "path/to/the/file")
```

</details>
<details>
<summary>Audio serializers</summary>

```
import os
from loaders.local_loaders.iterable_file_loaders.audio_loaders import AudioReader
from serializers.cloud_serializers.google.audio_serializers import AudioGoogleSerializer

if __name__ == "__main__":
    with AudioReader(r"D:\praca\esently\taski\ML-43\files\data\a.wav") as wav:
        with AudioGoogleSerializer(wav.get_file_buffer(), wav.sampling_rate, 'wav',
                                      tmp_folder_path="/tmp/") as test_serializer:
            test_serializer.serialize("bucket-name-here", "path/to/the/file")

```

</details>
</details>
</details>
<details>
<summary><b>Local</b></summary>
<details>
<summary>Video loaders</summary>
</details>
</details>
